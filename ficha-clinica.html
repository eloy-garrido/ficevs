<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Centro Vida Sana Austral - Sistema de fichas cl√≠nicas para Kinesiolog√≠a y Acupuntura">
    <meta name="theme-color" content="#2563eb">

    <title>Centro Vida Sana Austral - Nueva Ficha Cl√≠nica</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css?v=6.0">

    <!-- Manifest PWA -->
    <link rel="manifest" href="manifest.json">
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Header con Glassmorfismo Puro -->
    <header class="sticky top-0 z-40" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);">
        <div class="container mx-auto px-3 md:px-4 py-2">
            <div class="flex items-center justify-between gap-3">
                <!-- Logo + T√≠tulo (compacto) -->
                <div class="flex items-center gap-2">
                    <div class="w-7 h-7 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center shadow-lg flex-shrink-0">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                    </div>
                    <h1 class="text-xs md:text-sm font-bold text-white drop-shadow-lg hidden sm:block">Centro Vida Sana</h1>
                </div>

                <!-- Indicadores de Paso (Centro) -->
                <div class="flex items-center gap-2">
                    <div id="step-indicator-1" class="w-7 h-7 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 text-white flex items-center justify-center text-xs font-bold shadow-lg transition-all duration-300">1</div>
                    <div class="w-8 md:w-12 h-0.5 rounded-full" style="background: rgba(255, 255, 255, 0.3);">
                        <div id="progress-line-1" class="h-full bg-gradient-to-r from-blue-400 to-blue-500 rounded-full transition-all duration-500" style="width: 0%;"></div>
                    </div>
                    <div id="step-indicator-2" class="w-7 h-7 rounded-full text-white flex items-center justify-center text-xs font-bold shadow-lg transition-all duration-300" style="background: rgba(255, 255, 255, 0.25);">2</div>
                </div>

                <!-- Botones (compacto) -->
                <div class="flex items-center gap-1.5">
                    <button id="save-draft-btn" class="hidden md:flex items-center gap-1 text-xs text-white/90 hover:text-white transition px-2 py-1 rounded-lg hover:bg-white/10">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                        </svg>
                    </button>
                    <button id="logout-btn" class="flex items-center gap-1 text-xs text-white bg-red-500/90 hover:bg-red-500 px-2 py-1 rounded-lg transition shadow-lg">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                        <span class="hidden sm:inline">Salir</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Modal de Guardado con Glassmorfismo -->
    <div id="save-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center" style="background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);">
        <div class="save-modal-content" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px); border: 1px solid rgba(255, 255, 255, 0.5); border-radius: 24px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); padding: 3rem; min-width: 320px; text-align: center;">
            <!-- Estado: Guardando -->
            <div id="save-modal-saving" class="save-state">
                <div class="save-spinner">
                    <div class="spinner-ring"></div>
                    <div class="spinner-ring"></div>
                    <div class="spinner-ring"></div>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mt-6 mb-2">Guardando informaci√≥n</h3>
                <p class="text-gray-600 text-sm">Por favor espere...</p>
            </div>

            <!-- Estado: Guardado -->
            <div id="save-modal-success" class="save-state hidden">
                <div class="success-checkmark">
                    <svg class="w-20 h-20 text-green-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-green-600 mt-6 mb-2">¬°Guardado correctamente!</h3>
                <p class="text-gray-600 text-sm">Los datos se han almacenado exitosamente</p>
            </div>
        </div>
    </div>

    <!-- Contenedor Principal del Formulario -->
    <main class="container mx-auto px-4 py-4 max-w-4xl">

        <!-- PASO 1: Datos del Paciente -->
        <div id="step-1" class="card fade-in">
            <h2 class="text-xl md:text-2xl font-bold text-gray-900 mb-4">Paso 1: Datos del Paciente</h2>

            <form class="space-y-3">
                <!-- RUT - Campo Principal -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-xl border-2 border-blue-200 mb-4">
                    <label for="rut" class="block text-sm font-bold text-blue-900 mb-2">
                        <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2"></path>
                        </svg>
                        RUT del Paciente <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <input type="text" id="rut" required
                            class="w-full px-4 py-3 text-lg font-semibold border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/90 shadow-sm"
                            placeholder="12.345.678-9"
                            maxlength="12"
                            autocomplete="off">

                        <!-- Dropdown de Sugerencias -->
                        <div id="rut-suggestions" class="hidden absolute z-50 w-full mt-2 rounded-lg shadow-2xl overflow-hidden"
                            style="background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px); border: 1px solid rgba(59, 130, 246, 0.3); max-height: 300px; overflow-y: auto;">
                            <!-- Las sugerencias se insertar√°n aqu√≠ din√°micamente -->
                        </div>
                    </div>
                    <p class="text-xs text-blue-700 mt-2">
                        üí° Ingrese el RUT del paciente. Si ya est√° registrado, se autocompletar√°n sus datos.
                    </p>
                </div>

                <!-- Historial de Visitas Anteriores (solo visible para pacientes existentes) -->
                <div id="patient-history" class="hidden mb-4">
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-xl border-2 border-purple-200"
                        style="backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-sm font-bold text-purple-900">
                                <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Historial de Visitas Anteriores
                            </h3>
                            <button type="button" id="hide-history-btn" class="text-purple-600 hover:text-purple-800 text-xs font-medium">
                                Ocultar ‚úï
                            </button>
                        </div>

                        <!-- Tabla de historial -->
                        <div class="overflow-x-auto">
                            <table class="w-full text-xs">
                                <thead>
                                    <tr class="border-b border-purple-200">
                                        <th class="text-left py-2 px-2 text-purple-900 font-semibold">Fecha</th>
                                        <th class="text-left py-2 px-2 text-purple-900 font-semibold">Motivo de Consulta</th>
                                        <th class="text-left py-2 px-2 text-purple-900 font-semibold">Profesional</th>
                                    </tr>
                                </thead>
                                <tbody id="history-table-body" class="text-gray-700">
                                    <!-- Las filas se insertar√°n aqu√≠ din√°micamente -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Mensaje si no hay historial -->
                        <div id="no-history-msg" class="hidden text-center py-4 text-purple-600 text-xs">
                            No hay visitas anteriores registradas
                        </div>

                        <p class="text-xs text-purple-600 mt-3 italic">
                            üìã Este es el historial de consultas anteriores. La nueva ficha ser√° independiente.
                        </p>
                    </div>
                </div>

                <!-- Nombre del Paciente -->
                <div>
                    <label for="nombre-paciente" class="block text-xs font-medium text-gray-700 mb-1">
                        Nombre Completo <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="nombre-paciente" required
                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80"
                        placeholder="Juan P√©rez">
                </div>

                <!-- Fecha de Nacimiento y Edad -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div>
                        <label for="fecha-nacimiento" class="block text-xs font-medium text-gray-700 mb-1">
                            Fecha Nac. <span class="text-red-500">*</span>
                        </label>
                        <input type="date" id="fecha-nacimiento" required
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80">
                    </div>

                    <div>
                        <label for="edad" class="block text-xs font-medium text-gray-700 mb-1">
                            Edad <span class="text-xs text-gray-500">(auto)</span>
                        </label>
                        <input type="number" id="edad" readonly
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"
                            placeholder="Auto">
                    </div>
                </div>

                <!-- Tel√©fono y Fecha de Ingreso -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">
                            Tel√©fono <span class="text-red-500">*</span>
                        </label>
                        <div class="flex gap-2">
                            <input type="text" id="telefono-codigo" value="+569"
                                class="w-16 px-2 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80 text-center font-semibold"
                                placeholder="+569">
                            <input type="tel" id="telefono-numero" required
                                class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80"
                                placeholder="12345678"
                                maxlength="8"
                                pattern="[0-9]{8}">
                        </div>
                    </div>

                    <div>
                        <label for="fecha-ingreso" class="block text-xs font-medium text-gray-700 mb-1">
                            Fecha de Ingreso
                        </label>
                        <input type="date" id="fecha-ingreso"
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80">
                    </div>
                </div>

                <!-- Email, Ocupaci√≥n y Direcci√≥n -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <div>
                        <label for="email" class="block text-xs font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="email"
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80"
                            placeholder="juan@ejemplo.com">
                    </div>

                    <div>
                        <label for="ocupacion" class="block text-xs font-medium text-gray-700 mb-1">Ocupaci√≥n</label>
                        <input type="text" id="ocupacion"
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80"
                            placeholder="Ingeniero">
                    </div>

                    <div>
                        <label for="direccion" class="block text-xs font-medium text-gray-700 mb-1">Direcci√≥n</label>
                        <input type="text" id="direccion"
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80"
                            placeholder="Calle 123, Comuna">
                    </div>
                </div>

                <!-- Motivo de Consulta -->
                <div>
                    <label for="motivo-consulta" class="block text-xs font-medium text-gray-700 mb-1">
                        Motivo de Consulta <span class="text-red-500">*</span>
                    </label>
                    <textarea id="motivo-consulta" required rows="3"
                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80"
                        placeholder="Describa el motivo principal de la consulta..."></textarea>
                </div>

                <!-- Selecci√≥n de Profesional -->
                <div class="mt-6 pt-6 border-t-2 border-gray-200">
                    <label class="block text-xs font-medium text-gray-700 mb-3">
                        Profesional que Atender√° <span class="text-red-500">*</span>
                    </label>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <!-- Opci√≥n: Kinesi√≥logo -->
                        <label for="profesional-kinesiologo" class="cursor-pointer">
                            <input type="radio" id="profesional-kinesiologo" name="profesional" value="kinesiologo" class="hidden profesional-radio">
                            <div class="profesional-button border-2 border-gray-300 rounded-lg p-4 transition-all duration-200">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-700 rounded-full flex items-center justify-center flex-shrink-0 shadow-md">
                                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                        </svg>
                                    </div>
                                    <div class="flex-1 text-left">
                                        <h4 class="text-sm font-bold text-gray-900">Kinesi√≥logo</h4>
                                        <p class="text-xs text-gray-600">Rehabilitaci√≥n y terapia f√≠sica</p>
                                    </div>
                                </div>
                            </div>
                        </label>

                        <!-- Opci√≥n: Acupunturista -->
                        <label for="profesional-acupunturista" class="cursor-pointer">
                            <input type="radio" id="profesional-acupunturista" name="profesional" value="acupunturista" class="hidden profesional-radio">
                            <div class="profesional-button border-2 border-gray-300 rounded-lg p-4 transition-all duration-200">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full flex items-center justify-center flex-shrink-0 shadow-md">
                                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="flex-1 text-left">
                                        <h4 class="text-sm font-bold text-gray-900">Acupunturista</h4>
                                        <p class="text-xs text-gray-600">Medicina Tradicional China</p>
                                    </div>
                                </div>
                            </div>
                        </label>
                    </div>

                    <!-- Mensaje de error si no selecciona -->
                    <div id="profesional-error" class="hidden text-red-600 text-center mt-3">
                        <p class="text-xs">Por favor, seleccione un profesional para continuar</p>
                    </div>

                    <!-- Estilos para botones seleccionados -->
                    <style>
                        .profesional-radio:checked + .profesional-button {
                            border-width: 2px;
                            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                        }

                        #profesional-kinesiologo:checked + .profesional-button {
                            border-color: #3b82f6;
                            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(59, 130, 246, 0.08) 100%);
                        }

                        #profesional-acupunturista:checked + .profesional-button {
                            border-color: #a855f7;
                            background: linear-gradient(135deg, rgba(168, 85, 247, 0.05) 0%, rgba(168, 85, 247, 0.08) 100%);
                        }
                    </style>
                </div>
            </form>
        </div>

        <!-- PASO 2: Formularios Condicionales (antes paso 3) -->

        <!-- PASO 2 - KINESI√ìLOGO -->
        <div id="step-2-kinesiologo" class="card fade-in hidden">
            <h2 class="text-3xl font-bold text-gray-900 mb-6">Paso 2: Evaluaci√≥n Kinesiol√≥gica</h2>

            <form class="space-y-8">
                <!-- Evaluaci√≥n Funcional -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-blue-900 mb-4">Evaluaci√≥n Funcional</h3>

                    <!-- Movilidad Articular -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Movilidad Articular</label>
                        <textarea id="kine-movilidad" rows="3"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Describa limitaciones de movilidad, rangos articulares..."></textarea>
                    </div>

                    <!-- Fuerza Muscular -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Fuerza Muscular</label>
                        <textarea id="kine-fuerza" rows="3"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Evaluaci√≥n de grupos musculares, debilidades detectadas..."></textarea>
                    </div>

                    <!-- Postura -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">An√°lisis Postural</label>
                        <textarea id="kine-postura" rows="3"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Alteraciones posturales, desviaciones, compensaciones..."></textarea>
                    </div>
                </div>

                <!-- Evaluaci√≥n del Dolor -->
                <div class="bg-red-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-red-900 mb-4">Evaluaci√≥n del Dolor</h3>

                    <!-- Ubicaci√≥n -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ubicaci√≥n del Dolor/Lesi√≥n</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="cervical" class="text-red-600">
                                <span>Cervical</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="hombro" class="text-red-600">
                                <span>Hombro</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="codo" class="text-red-600">
                                <span>Codo</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="muneca" class="text-red-600">
                                <span>Mu√±eca/Mano</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="dorsal" class="text-red-600">
                                <span>Dorsal</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="lumbar" class="text-red-600">
                                <span>Lumbar</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="cadera" class="text-red-600">
                                <span>Cadera</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="rodilla" class="text-red-600">
                                <span>Rodilla</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="tobillo" class="text-red-600">
                                <span>Tobillo/Pie</span>
                            </label>
                        </div>
                    </div>

                    <!-- Intensidad del Dolor -->
                    <div class="mb-4">
                        <label for="kine-dolor-intensidad" class="block text-sm font-medium text-gray-700 mb-2">
                            Intensidad del Dolor (1-10)
                        </label>
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-gray-600">Leve</span>
                            <input type="range" id="kine-dolor-intensidad" min="1" max="10" value="5"
                                class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <span class="text-sm text-gray-600">Severo</span>
                            <span id="kine-dolor-intensidad-valor" class="text-2xl font-bold text-red-600 ml-4">5</span>
                        </div>
                    </div>

                    <!-- Caracter√≠sticas del Dolor -->
                    <div>
                        <label for="kine-dolor-caracteristicas" class="block text-sm font-medium text-gray-700 mb-2">
                            Caracter√≠sticas del Dolor
                        </label>
                        <textarea id="kine-dolor-caracteristicas" rows="2"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
                            placeholder="Tipo de dolor (punzante, sordo, quemante), frecuencia, factores que lo agravan o alivian..."></textarea>
                    </div>
                </div>

                <!-- Pruebas Especiales -->
                <div class="bg-green-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-green-900 mb-4">Pruebas Especiales y Tests</h3>
                    <textarea id="kine-tests" rows="4"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                        placeholder="Resultados de tests especiales, maniobras diagn√≥sticas realizadas..."></textarea>
                </div>

                <!-- Diagn√≥stico Kinesiol√≥gico -->
                <div class="bg-purple-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-purple-900 mb-4">Diagn√≥stico Kinesiol√≥gico</h3>
                    <textarea id="kine-diagnostico" rows="4"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                        placeholder="Diagn√≥stico kinesiol√≥gico, hip√≥tesis diagn√≥stica..."></textarea>
                </div>

                <!-- Plan de Tratamiento -->
                <div class="bg-yellow-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-yellow-900 mb-4">Plan de Tratamiento</h3>

                    <!-- Objetivos -->
                    <div class="mb-4">
                        <label for="kine-objetivos" class="block text-sm font-medium text-gray-700 mb-2">
                            Objetivos del Tratamiento
                        </label>
                        <textarea id="kine-objetivos" rows="3"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"
                            placeholder="Objetivos a corto y largo plazo..."></textarea>
                    </div>

                    <!-- T√©cnicas a Aplicar -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">T√©cnicas y Modalidades</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-tecnicas" value="terapia_manual" class="text-yellow-600">
                                <span>Terapia Manual</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-tecnicas" value="ejercicios" class="text-yellow-600">
                                <span>Ejercicios Terap√©uticos</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-tecnicas" value="electroterapia" class="text-yellow-600">
                                <span>Electroterapia</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-tecnicas" value="ultrasonido" class="text-yellow-600">
                                <span>Ultrasonido</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-tecnicas" value="calor_frio" class="text-yellow-600">
                                <span>Termoterapia/Crioterapia</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-tecnicas" value="vendaje" class="text-yellow-600">
                                <span>Vendaje Funcional/Kinesiotape</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-tecnicas" value="masoterapia" class="text-yellow-600">
                                <span>Masoterapia</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-tecnicas" value="reeducacion" class="text-yellow-600">
                                <span>Reeducaci√≥n Postural</span>
                            </label>
                        </div>
                    </div>

                    <!-- Frecuencia y Duraci√≥n -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="kine-frecuencia" class="block text-sm font-medium text-gray-700 mb-2">
                                Frecuencia de Sesiones
                            </label>
                            <input type="text" id="kine-frecuencia"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"
                                placeholder="Ej: 2-3 veces por semana">
                        </div>
                        <div>
                            <label for="kine-duracion" class="block text-sm font-medium text-gray-700 mb-2">
                                Duraci√≥n Estimada
                            </label>
                            <input type="text" id="kine-duracion"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"
                                placeholder="Ej: 4-6 semanas">
                        </div>
                    </div>

                    <!-- Ejercicios en Casa -->
                    <div>
                        <label for="kine-ejercicios-casa" class="block text-sm font-medium text-gray-700 mb-2">
                            Ejercicios en Casa / Recomendaciones
                        </label>
                        <textarea id="kine-ejercicios-casa" rows="3"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"
                            placeholder="Ejercicios y recomendaciones para realizar en casa..."></textarea>
                    </div>
                </div>

                <!-- Consentimiento Informado -->
                <div class="bg-green-50 p-6 rounded-lg border-2 border-green-200">
                    <label class="flex items-start space-x-3 cursor-pointer">
                        <input type="checkbox" id="kine-consentimiento" required class="mt-1 text-green-600">
                        <div>
                            <span class="font-semibold text-green-900">Consentimiento Informado <span class="text-red-500">*</span></span>
                            <p class="text-sm text-gray-700 mt-1">
                                El paciente ha sido informado sobre el tratamiento kinesiol√≥gico propuesto, sus posibles beneficios,
                                riesgos y alternativas. El paciente da su consentimiento para proceder con el tratamiento y entiende
                                que puede retirarlo en cualquier momento.
                            </p>
                        </div>
                    </label>
                </div>
            </form>
        </div>

        <!-- PASO 3 - ACUPUNTURISTA: MTC (Lengua y Pulso) -->
        <div id="step-2-acupunturista" class="hidden">
        <div class="card fade-in">
            <h2 class="text-3xl font-bold text-gray-900 mb-6">Paso 2: Evaluaci√≥n y Diagn√≥stico MTC</h2>

            <form class="space-y-8">
                <!-- Secci√≥n Lengua -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-blue-900 mb-4">Lengua</h3>

                    <!-- Color de la Lengua -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Color</label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-color" value="palida" class="text-blue-600">
                                <span>P√°lida</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-color" value="normal" class="text-blue-600">
                                <span>Normal (rosada)</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-color" value="roja" class="text-blue-600">
                                <span>Roja</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-color" value="purpura" class="text-blue-600">
                                <span>P√∫rpura</span>
                            </label>
                        </div>
                    </div>

                    <!-- Saburra -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Saburra</label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-saburra" value="fina-blanca" class="text-blue-600">
                                <span>Fina y blanca</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-saburra" value="gruesa" class="text-blue-600">
                                <span>Gruesa</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-saburra" value="amarilla" class="text-blue-600">
                                <span>Amarilla</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-saburra" value="sin-saburra" class="text-blue-600">
                                <span>Sin saburra</span>
                            </label>
                        </div>
                    </div>

                    <!-- Forma -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Forma</label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-forma" value="normal" class="text-blue-600">
                                <span>Normal</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-forma" value="hinchada" class="text-blue-600">
                                <span>Hinchada</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-forma" value="delgada" class="text-blue-600">
                                <span>Delgada</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-forma" value="rigida" class="text-blue-600">
                                <span>R√≠gida</span>
                            </label>
                        </div>
                    </div>

                    <!-- Observaciones de Lengua -->
                    <div>
                        <label for="lengua-observaciones" class="block text-sm font-medium text-gray-700 mb-2">
                            Observaciones adicionales
                        </label>
                        <textarea id="lengua-observaciones" rows="2"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Observaciones sobre la lengua..."></textarea>
                    </div>
                </div>

                <!-- Secci√≥n Pulso -->
                <div class="bg-green-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-green-900 mb-4">Pulso</h3>

                    <!-- Profundidad -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Profundidad</label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-profundidad" value="superficial" class="text-green-600">
                                <span>Superficial</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-profundidad" value="medio" class="text-green-600">
                                <span>Medio</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-profundidad" value="profundo" class="text-green-600">
                                <span>Profundo</span>
                            </label>
                        </div>
                    </div>

                    <!-- Velocidad -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Velocidad</label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-velocidad" value="lento" class="text-green-600">
                                <span>Lento (< 4 latidos/respiraci√≥n)</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-velocidad" value="normal" class="text-green-600">
                                <span>Normal (4-5 latidos/respiraci√≥n)</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-velocidad" value="rapido" class="text-green-600">
                                <span>R√°pido (> 5 latidos/respiraci√≥n)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Fuerza -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Fuerza</label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-fuerza" value="debil" class="text-green-600">
                                <span>D√©bil</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-fuerza" value="normal" class="text-green-600">
                                <span>Normal</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-fuerza" value="fuerte" class="text-green-600">
                                <span>Fuerte</span>
                            </label>
                        </div>
                    </div>

                    <!-- Calidad -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Calidad</label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-calidad" value="resbaladizo" class="text-green-600">
                                <span>Resbaladizo</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-calidad" value="rugoso" class="text-green-600">
                                <span>Rugoso</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-calidad" value="tenso" class="text-green-600">
                                <span>Tenso</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-calidad" value="filiforme" class="text-green-600">
                                <span>Filiforme</span>
                            </label>
                        </div>
                    </div>

                    <!-- Observaciones de Pulso -->
                    <div>
                        <label for="pulso-observaciones" class="block text-sm font-medium text-gray-700 mb-2">
                            Observaciones adicionales
                        </label>
                        <textarea id="pulso-observaciones" rows="2"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="Observaciones sobre el pulso..."></textarea>
                    </div>
                </div>

                <!-- S√≠ntomas Generales -->
                <div class="bg-yellow-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-yellow-900 mb-4">S√≠ntomas Principales</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="sintomas" value="dolor_cabeza" class="text-yellow-600">
                            <span>Dolor de cabeza</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="sintomas" value="mareos" class="text-yellow-600">
                            <span>Mareos</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="sintomas" value="insomnio" class="text-yellow-600">
                            <span>Insomnio</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="sintomas" value="fatiga" class="text-yellow-600">
                            <span>Fatiga</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="sintomas" value="sudoracion" class="text-yellow-600">
                            <span>Sudoraci√≥n excesiva</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="sintomas" value="frio" class="text-yellow-600">
                            <span>Sensaci√≥n de fr√≠o</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="sintomas" value="calor" class="text-yellow-600">
                            <span>Sensaci√≥n de calor</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="sintomas" value="palpitaciones" class="text-yellow-600">
                            <span>Palpitaciones</span>
                        </label>
                    </div>
                </div>

                <!-- Emociones -->
                <div class="bg-purple-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-purple-900 mb-4">Estado Emocional</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="emociones" value="ansiedad" class="text-purple-600">
                            <span>Ansiedad</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="emociones" value="estres" class="text-purple-600">
                            <span>Estr√©s</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="emociones" value="tristeza" class="text-purple-600">
                            <span>Tristeza</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="emociones" value="irritabilidad" class="text-purple-600">
                            <span>Irritabilidad</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="emociones" value="preocupacion" class="text-purple-600">
                            <span>Preocupaci√≥n excesiva</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="emociones" value="miedo" class="text-purple-600">
                            <span>Miedo</span>
                        </label>
                    </div>
                </div>

                <!-- S√≠ntomas Digestivos -->
                <div class="bg-green-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-green-900 mb-4">S√≠ntomas Digestivos</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="digestivos" value="nauseas" class="text-green-600">
                            <span>N√°useas</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="digestivos" value="vomitos" class="text-green-600">
                            <span>V√≥mitos</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="digestivos" value="diarrea" class="text-green-600">
                            <span>Diarrea</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="digestivos" value="estre√±imiento" class="text-green-600">
                            <span>Estre√±imiento</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="digestivos" value="hinchazon" class="text-green-600">
                            <span>Hinchaz√≥n abdominal</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="digestivos" value="gastritis" class="text-green-600">
                            <span>Gastritis</span>
                        </label>
                    </div>
                </div>

                <!-- S√≠ntomas Menstruales -->
                <div class="bg-pink-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-pink-900 mb-4">S√≠ntomas Menstruales (si aplica)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="menstruales" value="irregularidad" class="text-pink-600">
                            <span>Irregularidad menstrual</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="menstruales" value="dolor" class="text-pink-600">
                            <span>Dolor menstrual</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="menstruales" value="flujo_abundante" class="text-pink-600">
                            <span>Flujo abundante</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="menstruales" value="flujo_escaso" class="text-pink-600">
                            <span>Flujo escaso</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="menstruales" value="coagulos" class="text-pink-600">
                            <span>Co√°gulos</span>
                        </label>
                    </div>
                </div>

                <!-- Otros s√≠ntomas -->
                <div class="mb-6">
                    <label for="otros-sintomas" class="block text-sm font-medium text-gray-700 mb-2">
                        Otros s√≠ntomas no listados
                    </label>
                    <textarea id="otros-sintomas" rows="3"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Describa cualquier otro s√≠ntoma relevante..."></textarea>
                </div>

                <!-- Evaluaci√≥n del Dolor -->
                <div class="bg-red-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-red-900 mb-4">Ubicaci√≥n del Dolor</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-ubicacion" value="cervical" class="text-red-600">
                            <span>Cervical</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-ubicacion" value="dorsal" class="text-red-600">
                            <span>Dorsal</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-ubicacion" value="lumbar" class="text-red-600">
                            <span>Lumbar</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-ubicacion" value="hombro" class="text-red-600">
                            <span>Hombro</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-ubicacion" value="rodilla" class="text-red-600">
                            <span>Rodilla</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-ubicacion" value="cadera" class="text-red-600">
                            <span>Cadera</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-ubicacion" value="extremidades" class="text-red-600">
                            <span>Extremidades</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-ubicacion" value="abdomen" class="text-red-600">
                            <span>Abdomen</span>
                        </label>
                    </div>
                </div>

                <!-- Tipo de Dolor -->
                <div class="bg-orange-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-orange-900 mb-4">Tipo de Dolor</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-tipo" value="punzante" class="text-orange-600">
                            <span>Punzante</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-tipo" value="sordo" class="text-orange-600">
                            <span>Sordo</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-tipo" value="quemante" class="text-orange-600">
                            <span>Quemante</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-tipo" value="opresivo" class="text-orange-600">
                            <span>Opresivo</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-tipo" value="pulsatil" class="text-orange-600">
                            <span>Puls√°til</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-tipo" value="lacerante" class="text-orange-600">
                            <span>Lacerante</span>
                        </label>
                    </div>
                </div>

                <!-- Intensidad del Dolor -->
                <div class="mb-6">
                    <label for="dolor-intensidad" class="block text-sm font-medium text-gray-700 mb-2">
                        Intensidad del Dolor (1-10)
                    </label>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600">Leve</span>
                        <input type="range" id="dolor-intensidad" min="1" max="10" value="5"
                            class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <span class="text-sm text-gray-600">Severo</span>
                        <span id="dolor-intensidad-valor" class="text-2xl font-bold text-red-600 ml-4">5</span>
                    </div>
                </div>

                <!-- Frecuencia del Dolor -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Frecuencia del Dolor</label>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="dolor-frecuencia" value="constante" class="text-blue-600">
                            <span>Constante</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="dolor-frecuencia" value="intermitente" class="text-blue-600">
                            <span>Intermitente</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="dolor-frecuencia" value="ocasional" class="text-blue-600">
                            <span>Ocasional</span>
                        </label>
                    </div>
                </div>

                <!-- Factores de Alivio -->
                <div class="mb-6">
                    <label for="factores-alivio" class="block text-sm font-medium text-gray-700 mb-2">
                        ¬øQu√© alivia el dolor?
                    </label>
                    <textarea id="factores-alivio" rows="2"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Ej: reposo, calor, masajes..."></textarea>
                </div>

                <!-- Factores de Agravaci√≥n -->
                <div class="mb-6">
                    <label for="factores-agravacion" class="block text-sm font-medium text-gray-700 mb-2">
                        ¬øQu√© agrava el dolor?
                    </label>
                    <textarea id="factores-agravacion" rows="2"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Ej: movimiento, fr√≠o, estr√©s..."></textarea>
                </div>

                <!-- Diagn√≥stico y Tratamiento MTC -->
                <div class="bg-gray-50 p-6 rounded-lg border-2 border-gray-200 mb-6">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        Resumen de la Ficha
                    </h3>
                    <div id="ficha-summary"></div>
                </div>

                <!-- Diagn√≥stico del Terapeuta -->
                <div class="mb-6">
                    <label for="diagnostico" class="block text-sm font-medium text-gray-700 mb-2">
                        Diagn√≥stico del Terapeuta (MTC)
                    </label>
                    <textarea id="diagnostico" rows="4"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Ej: Deficiencia de Qi de Bazo, Estancamiento de Qi de H√≠gado..."></textarea>
                </div>

                <!-- Plan de Tratamiento -->
                <div class="mb-6">
                    <label for="plan-tratamiento" class="block text-sm font-medium text-gray-700 mb-2">
                        Plan de Tratamiento
                    </label>
                    <textarea id="plan-tratamiento" rows="4"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Describa el plan de tratamiento propuesto..."></textarea>
                </div>

                <!-- Puntos de Acupuntura -->
                <div class="mb-6">
                    <label for="puntos-acupuntura" class="block text-sm font-medium text-gray-700 mb-2">
                        Puntos de Acupuntura
                    </label>
                    <input type="text" id="puntos-acupuntura"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Ej: E36, IG4, H3, B6... (separados por comas)">
                    <p class="mt-1 text-sm text-gray-500">Ingrese los puntos separados por comas</p>
                </div>

                <!-- T√©cnicas Aplicadas -->
                <div class="bg-blue-50 p-6 rounded-lg mb-6">
                    <h3 class="text-lg font-semibold text-blue-900 mb-3">T√©cnicas a Aplicar</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="tecnicas" value="acupuntura" class="text-blue-600">
                            <span>Acupuntura</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="tecnicas" value="moxibustion" class="text-blue-600">
                            <span>Moxibusti√≥n</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="tecnicas" value="ventosas" class="text-blue-600">
                            <span>Ventosas</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="tecnicas" value="electroacupuntura" class="text-blue-600">
                            <span>Electroacupuntura</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="tecnicas" value="tuina" class="text-blue-600">
                            <span>Tuina (masaje)</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="tecnicas" value="auriculoterapia" class="text-blue-600">
                            <span>Auriculoterapia</span>
                        </label>
                    </div>
                </div>

                <!-- Recomendaciones -->
                <div class="mb-6">
                    <label for="recomendaciones" class="block text-sm font-medium text-gray-700 mb-2">
                        Recomendaciones para el Paciente
                    </label>
                    <textarea id="recomendaciones" rows="4"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Recomendaciones diet√©ticas, ejercicios, h√°bitos, etc."></textarea>
                </div>

                <!-- Consentimiento Informado -->
                <div class="bg-green-50 p-6 rounded-lg border-2 border-green-200">
                    <label class="flex items-start space-x-3 cursor-pointer">
                        <input type="checkbox" id="consentimiento" required class="mt-1 text-green-600">
                        <div>
                            <span class="font-semibold text-green-900">Consentimiento Informado <span class="text-red-500">*</span></span>
                            <p class="text-sm text-gray-700 mt-1">
                                El paciente ha sido informado sobre el tratamiento propuesto, sus posibles beneficios y riesgos,
                                y ha dado su consentimiento para proceder. El paciente entiende que puede retirar su consentimiento
                                en cualquier momento.
                            </p>
                        </div>
                    </label>
                </div>
            </form>
        </div>
        </div>

        <!-- OLD STEPS REMOVED - Content integrated above into step-3-acupunturista -->

        <!-- Botones de Navegaci√≥n -->
        <div class="flex justify-between items-center mt-8">
            <button id="prev-btn" class="hidden bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition font-semibold">
                ‚Üê Anterior
            </button>

            <div class="flex-1"></div>

            <button id="next-btn" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold">
                Siguiente ‚Üí
            </button>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-3 mt-6">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm">&copy; 2025 Centro Vida Sana Austral</p>
            <p class="text-xs mt-0.5 text-gray-400">Kinesiolog√≠a ‚Ä¢ Acupuntura</p>
        </div>
    </footer>

    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- App Scripts -->
    <script type="module">
        import { initSupabase, requireAuth, signOut } from './js/auth.js';
        import { initFormManager } from './js/formManager.js';
        import { storage } from './js/utils.js';

        // Inicializar aplicaci√≥n
        async function init() {
            // Inicializar Supabase
            await initSupabase();

            // Requiere autenticaci√≥n
            const authenticated = await requireAuth();
            if (!authenticated) return;

            // Inicializar gestor de formulario
            initFormManager();

            // Setup event listeners adicionales
            setupEventListeners();
        }

        function setupEventListeners() {
            // Bot√≥n de logout
            document.getElementById('logout-btn')?.addEventListener('click', async () => {
                if (confirm('¬øEst√°s seguro de que deseas cerrar sesi√≥n?')) {
                    await signOut();
                }
            });

            // Bot√≥n de guardar borrador manual
            document.getElementById('save-draft-btn')?.addEventListener('click', () => {
                // La funci√≥n de guardado est√° en formManager.js
                storage.saveDraft(window.formState?.formData || {});
            });

            // Actualizar valor de intensidad de dolor (Acupuntura)
            const dolorIntensidad = document.getElementById('dolor-intensidad');
            const dolorIntensidadValor = document.getElementById('dolor-intensidad-valor');

            if (dolorIntensidad && dolorIntensidadValor) {
                dolorIntensidad.addEventListener('input', (e) => {
                    dolorIntensidadValor.textContent = e.target.value;
                });
            }

            // Actualizar valor de intensidad de dolor (Kinesiolog√≠a)
            const kineDolorIntensidad = document.getElementById('kine-dolor-intensidad');
            const kineDolorIntensidadValor = document.getElementById('kine-dolor-intensidad-valor');

            if (kineDolorIntensidad && kineDolorIntensidadValor) {
                kineDolorIntensidad.addEventListener('input', (e) => {
                    kineDolorIntensidadValor.textContent = e.target.value;
                });
            }

            // ====================================
            // NUEVAS FUNCIONALIDADES
            // ====================================

            // Setear fecha de ingreso autom√°ticamente a hoy
            const fechaIngresoInput = document.getElementById('fecha-ingreso');
            if (fechaIngresoInput && !fechaIngresoInput.value) {
                const today = new Date().toISOString().split('T')[0];
                fechaIngresoInput.value = today;
            }

            // Calcular edad autom√°ticamente desde fecha de nacimiento
            const fechaNacimientoInput = document.getElementById('fecha-nacimiento');
            const edadInput = document.getElementById('edad');

            if (fechaNacimientoInput && edadInput) {
                fechaNacimientoInput.addEventListener('change', (e) => {
                    const birthDate = new Date(e.target.value);
                    const today = new Date();

                    if (!isNaN(birthDate.getTime())) {
                        let age = today.getFullYear() - birthDate.getFullYear();
                        const monthDiff = today.getMonth() - birthDate.getMonth();

                        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                            age--;
                        }

                        edadInput.value = age >= 0 ? age : '';
                    } else {
                        edadInput.value = '';
                    }
                });
            }

            // ====================================
            // B√öSQUEDA Y AUTOCOMPLETADO POR RUT
            // ====================================
            const rutInput = document.getElementById('rut');
            const rutSuggestions = document.getElementById('rut-suggestions');
            let searchTimeout = null;

            if (rutInput && rutSuggestions) {
                // Formatear y buscar al escribir
                rutInput.addEventListener('input', async (e) => {
                    let value = e.target.value.replace(/[^0-9kK]/g, '');

                    // Formatear RUT
                    if (value.length > 0) {
                        const dv = value.slice(-1);
                        let number = value.slice(0, -1);
                        number = number.replace(/\B(?=(\d{3})+(?!\d))/g, '.');

                        if (value.length > 1) {
                            e.target.value = number + '-' + dv;
                        } else {
                            e.target.value = value;
                        }
                    }

                    // Buscar pacientes con debounce
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(async () => {
                        const rutValue = e.target.value.trim();

                        // Buscar desde el primer car√°cter (b√∫squeda m√°s inteligente)
                        if (rutValue.length >= 1) {
                            try {
                                // Limpiar el RUT para la b√∫squeda (quitar puntos y guiones)
                                const cleanRut = rutValue.replace(/[.\-]/g, '');

                                // Importar la funci√≥n de b√∫squeda
                                const { searchPatientByRut } = await import('./js/supabaseService.js');
                                const patients = await searchPatientByRut(cleanRut);

                                if (patients && patients.length > 0) {
                                    showSuggestions(patients);
                                } else {
                                    hideSuggestions();
                                }
                            } catch (error) {
                                console.error('Error al buscar pacientes:', error);
                                hideSuggestions();
                            }
                        } else {
                            hideSuggestions();
                        }
                    }, 200); // 200ms de debounce (m√°s r√°pido)
                });

                // Validar RUT al salir del campo
                rutInput.addEventListener('blur', (e) => {
                    // Delay para permitir clic en sugerencias
                    setTimeout(() => {
                        const rut = e.target.value;
                        if (rut && !validarRUT(rut)) {
                            e.target.classList.add('border-red-500');
                            if (!document.getElementById('rut-error')) {
                                const errorMsg = document.createElement('p');
                                errorMsg.id = 'rut-error';
                                errorMsg.className = 'text-red-500 text-sm mt-1';
                                errorMsg.textContent = 'RUT inv√°lido';
                                e.target.parentElement.appendChild(errorMsg);
                            }
                        } else {
                            e.target.classList.remove('border-red-500');
                            document.getElementById('rut-error')?.remove();
                        }
                        hideSuggestions();
                    }, 200);
                });

                // Mostrar sugerencias nuevamente al hacer focus
                rutInput.addEventListener('focus', async () => {
                    const rutValue = rutInput.value.trim();
                    if (rutValue.length >= 1) {
                        try {
                            // Limpiar el RUT para la b√∫squeda (quitar puntos y guiones)
                            const cleanRut = rutValue.replace(/[.\-]/g, '');

                            const { searchPatientByRut } = await import('./js/supabaseService.js');
                            const patients = await searchPatientByRut(cleanRut);
                            if (patients && patients.length > 0) {
                                showSuggestions(patients);
                            }
                        } catch (error) {
                            console.error('Error:', error);
                        }
                    }
                });
            }

            // Funci√≥n para mostrar sugerencias
            function showSuggestions(patients) {
                if (!rutSuggestions) return;

                rutSuggestions.innerHTML = '';

                patients.forEach(patient => {
                    const suggestion = document.createElement('div');
                    suggestion.className = 'suggestion-item p-4 cursor-pointer hover:bg-blue-50 border-b border-blue-100 transition-colors';

                    // Manejar nombre de tabla pacientes (nombre_completo) o fichas (nombre_paciente)
                    const nombrePaciente = patient.nombre_completo || patient.nombre_paciente || 'Sin nombre';

                    // Calcular edad si viene fecha_nacimiento pero no edad
                    let edad = patient.edad || 'N/A';
                    if (!patient.edad && patient.fecha_nacimiento) {
                        const birthDate = new Date(patient.fecha_nacimiento);
                        const today = new Date();
                        let calculatedAge = today.getFullYear() - birthDate.getFullYear();
                        const monthDiff = today.getMonth() - birthDate.getMonth();
                        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                            calculatedAge--;
                        }
                        edad = calculatedAge;
                    }

                    suggestion.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-900">${nombrePaciente}</p>
                                <p class="text-sm text-gray-600">RUT: ${patient.rut}</p>
                                <p class="text-xs text-gray-500">Edad: ${edad} ‚Ä¢ Tel: ${patient.telefono || 'N/A'}</p>
                            </div>
                            <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </div>
                    `;

                    suggestion.addEventListener('click', () => {
                        loadPatientData(patient);
                        hideSuggestions();
                    });

                    rutSuggestions.appendChild(suggestion);
                });

                rutSuggestions.classList.remove('hidden');
            }

            // Funci√≥n para ocultar sugerencias
            function hideSuggestions() {
                if (rutSuggestions) {
                    rutSuggestions.classList.add('hidden');
                }
            }

            // Funci√≥n para cargar datos del paciente
            async function loadPatientData(patient) {
                console.log('üìã Cargando datos del paciente:', patient);

                // Llenar solo los datos demogr√°ficos del paciente
                // NO cargar motivo_consulta ya que cada visita tiene su propio motivo
                document.getElementById('rut').value = patient.rut || '';

                // Manejar ambos campos: nombre_completo (tabla pacientes) y nombre_paciente (tabla fichas)
                document.getElementById('nombre-paciente').value = patient.nombre_completo || patient.nombre_paciente || '';

                document.getElementById('fecha-nacimiento').value = patient.fecha_nacimiento || '';

                // Calcular edad desde fecha_nacimiento si no viene el campo edad
                if (patient.fecha_nacimiento && !patient.edad) {
                    const birthDate = new Date(patient.fecha_nacimiento);
                    const today = new Date();
                    let age = today.getFullYear() - birthDate.getFullYear();
                    const monthDiff = today.getMonth() - birthDate.getMonth();
                    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                        age--;
                    }
                    document.getElementById('edad').value = age;
                } else {
                    document.getElementById('edad').value = patient.edad || '';
                }

                // Separar el tel√©fono en c√≥digo y n√∫mero
                if (patient.telefono) {
                    const telefonoParts = patient.telefono.split(' ');
                    if (telefonoParts.length >= 2) {
                        document.getElementById('telefono-codigo').value = telefonoParts[0];
                        document.getElementById('telefono-numero').value = telefonoParts[1];
                    } else {
                        document.getElementById('telefono-numero').value = patient.telefono;
                    }
                }

                document.getElementById('email').value = patient.email || '';
                document.getElementById('ocupacion').value = patient.ocupacion || '';
                document.getElementById('direccion').value = patient.direccion || '';

                // NO cargar motivo_consulta - cada visita es √∫nica
                // Dejar que el usuario ingrese un nuevo motivo
                document.getElementById('motivo-consulta').value = '';
                document.getElementById('motivo-consulta').placeholder = 'Ingrese el motivo de esta consulta...';

                // Usar fecha actual para nueva ficha
                document.getElementById('fecha-ingreso').value = new Date().toISOString().split('T')[0];

                // Guardar referencia al paciente existente (no al ID de ficha)
                // Esto nos ayudar√° a saber que es un paciente recurrente
                if (window.formState) {
                    window.formState.existingPatientRut = patient.rut;
                    window.formState.isExistingPatient = true;
                }

                // Cargar y mostrar historial de visitas anteriores
                await loadPatientHistory(patient.rut);

                // Mostrar notificaci√≥n
                console.log('‚úÖ Datos del paciente cargados:', patient.nombre_completo || patient.nombre_paciente);

                // Agregar indicador visual de que se cargaron datos existentes
                const rutInput = document.getElementById('rut');
                if (rutInput) {
                    rutInput.classList.add('border-green-500');
                    setTimeout(() => {
                        rutInput.classList.remove('border-green-500');
                    }, 2000);
                }

                // Mostrar mensaje informativo
                const infoMsg = document.createElement('div');
                infoMsg.className = 'mt-2 p-3 bg-green-50 border border-green-200 rounded-lg text-sm text-green-800 animate-fade-in';
                infoMsg.innerHTML = `
                    <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Paciente existente cargado. Puedes actualizar la informaci√≥n y crear una nueva ficha.
                `;

                const rutContainer = rutInput.closest('.bg-gradient-to-r');
                if (rutContainer && !document.getElementById('patient-loaded-msg')) {
                    infoMsg.id = 'patient-loaded-msg';
                    rutContainer.appendChild(infoMsg);

                    setTimeout(() => {
                        infoMsg.remove();
                    }, 5000);
                }
            }

            // Validar formato de tel√©fono (solo n√∫meros)
            const telefonoNumeroInput = document.getElementById('telefono-numero');
            if (telefonoNumeroInput) {
                telefonoNumeroInput.addEventListener('input', (e) => {
                    e.target.value = e.target.value.replace(/[^0-9]/g, '');
                });
            }

            // ====================================
            // HISTORIAL DE VISITAS
            // ====================================

            // Funci√≥n para cargar historial de visitas del paciente
            async function loadPatientHistory(rut) {
                try {
                    const { getPatientHistoryByRut } = await import('./js/supabaseService.js');
                    const history = await getPatientHistoryByRut(rut);

                    const historySection = document.getElementById('patient-history');
                    const historyTableBody = document.getElementById('history-table-body');
                    const noHistoryMsg = document.getElementById('no-history-msg');

                    if (!historySection || !historyTableBody) return;

                    // Limpiar tabla
                    historyTableBody.innerHTML = '';

                    if (history && history.length > 0) {
                        // Llenar tabla con historial
                        history.forEach((visita, index) => {
                            const fecha = new Date(visita.fecha_ingreso).toLocaleDateString('es-CL');
                            const motivo = visita.motivo_consulta || 'No especificado';

                            // Determinar profesional basado en datos (puedes mejorar esto)
                            let profesional = 'No especificado';

                            const row = document.createElement('tr');
                            row.className = 'border-b border-purple-100 hover:bg-purple-50 transition-colors';
                            row.innerHTML = `
                                <td class="py-2 px-2 font-medium">${fecha}</td>
                                <td class="py-2 px-2">${motivo}</td>
                                <td class="py-2 px-2">${profesional}</td>
                            `;
                            historyTableBody.appendChild(row);
                        });

                        // Mostrar tabla, ocultar mensaje
                        if (noHistoryMsg) noHistoryMsg.classList.add('hidden');
                        historyTableBody.parentElement.classList.remove('hidden');
                    } else {
                        // Mostrar mensaje, ocultar tabla
                        if (noHistoryMsg) noHistoryMsg.classList.remove('hidden');
                        historyTableBody.parentElement.classList.add('hidden');
                    }

                    // Mostrar secci√≥n de historial con animaci√≥n
                    historySection.classList.remove('hidden');
                    historySection.classList.add('animate-fade-in');

                } catch (error) {
                    console.error('Error al cargar historial:', error);
                }
            }

            // Bot√≥n para ocultar historial
            const hideHistoryBtn = document.getElementById('hide-history-btn');
            if (hideHistoryBtn) {
                hideHistoryBtn.addEventListener('click', () => {
                    const historySection = document.getElementById('patient-history');
                    if (historySection) {
                        historySection.classList.add('hidden');
                    }
                });
            }
        }

        // Funci√≥n para validar RUT chileno
        function validarRUT(rut) {
            // Limpiar formato
            rut = rut.replace(/\./g, '').replace(/-/g, '');

            if (rut.length < 2) return false;

            const dv = rut.slice(-1).toUpperCase();
            const numero = rut.slice(0, -1);

            if (!/^\d+$/.test(numero)) return false;

            // Calcular d√≠gito verificador
            let suma = 0;
            let multiplo = 2;

            for (let i = numero.length - 1; i >= 0; i--) {
                suma += parseInt(numero[i]) * multiplo;
                multiplo = multiplo === 7 ? 2 : multiplo + 1;
            }

            const dvEsperado = 11 - (suma % 11);
            const dvCalculado = dvEsperado === 11 ? '0' : dvEsperado === 10 ? 'K' : dvEsperado.toString();

            return dv === dvCalculado;
        }

        // Inicializar cuando el DOM est√© listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
