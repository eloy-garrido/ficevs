<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Centro Vida Sana Austral - Sistema de fichas clínicas para Kinesiología y Acupuntura">
    <meta name="theme-color" content="#2563eb">

    <title>Centro Vida Sana Austral - Nueva Ficha Clínica</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Manifest PWA -->
    <link rel="manifest" href="manifest.json">
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-40">
        <nav class="container mx-auto px-4 py-2 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center shadow-md flex-shrink-0">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                    </svg>
                </div>
                <div>
                    <h1 class="text-sm md:text-base font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Centro Vida Sana Austral</h1>
                    <p class="text-xs text-gray-600 hidden md:block">Nueva Ficha Clínica</p>
                </div>
            </div>

            <div class="flex items-center space-x-2">
                <button id="save-draft-btn" class="text-xs md:text-sm text-gray-600 hover:text-blue-600 transition hidden md:block">
                    Guardar
                </button>
                <button id="logout-btn" class="text-xs md:text-sm bg-red-500 text-white px-2 md:px-3 py-1.5 rounded-lg hover:bg-red-600 transition">
                    Salir
                </button>
            </div>
        </nav>

        <!-- Barra de progreso -->
        <div class="bg-gray-100 py-2">
            <div class="container mx-auto px-4">
                <!-- Indicador de progreso -->
                <div class="flex justify-between items-center mb-1.5">
                    <span id="progress-text" class="text-xs font-medium text-gray-700">Paso 1 de 3</span>
                    <span class="text-xs text-gray-500 hidden md:block">Auto-guardado</span>
                </div>

                <!-- Barra -->
                <div class="progress-container">
                    <div id="progress-bar" class="progress-bar" style="width: 33.33%"></div>
                </div>

                <!-- Indicadores de pasos -->
                <div class="flex justify-center gap-6 md:gap-8 mt-2">
                    <div class="flex flex-col items-center">
                        <div id="step-indicator-1" class="step-indicator bg-blue-600 text-white">1</div>
                        <span class="text-xs mt-0.5 text-gray-600 hidden sm:block">Datos</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <div id="step-indicator-2" class="step-indicator bg-gray-300 text-gray-600">2</div>
                        <span class="text-xs mt-0.5 text-gray-600 hidden sm:block">Profesional</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <div id="step-indicator-3" class="step-indicator bg-gray-300 text-gray-600">3</div>
                        <span class="text-xs mt-0.5 text-gray-600 hidden sm:block">Evaluación</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Contenedor Principal del Formulario -->
    <main class="container mx-auto px-4 py-4 max-w-4xl">

        <!-- PASO 1: Datos del Paciente -->
        <div id="step-1" class="card fade-in">
            <h2 class="text-xl md:text-2xl font-bold text-gray-900 mb-4">Paso 1: Datos del Paciente</h2>

            <form class="space-y-3">
                <!-- Nombre del Paciente -->
                <div>
                    <label for="nombre-paciente" class="block text-xs font-medium text-gray-700 mb-1">
                        Nombre Completo <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="nombre-paciente" required
                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80"
                        placeholder="Juan Pérez">
                </div>

                <!-- RUT, Fecha de Nacimiento y Edad -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <div>
                        <label for="rut" class="block text-xs font-medium text-gray-700 mb-1">
                            RUT <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="rut" required
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80"
                            placeholder="12.345.678-9"
                            maxlength="12">
                    </div>

                    <div>
                        <label for="fecha-nacimiento" class="block text-xs font-medium text-gray-700 mb-1">
                            Fecha Nac. <span class="text-red-500">*</span>
                        </label>
                        <input type="date" id="fecha-nacimiento" required
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80">
                    </div>

                    <div>
                        <label for="edad" class="block text-xs font-medium text-gray-700 mb-1">
                            Edad <span class="text-xs text-gray-500">(auto)</span>
                        </label>
                        <input type="number" id="edad" readonly
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"
                            placeholder="Auto">
                    </div>
                </div>

                <!-- Teléfono y Fecha de Ingreso -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1">
                            Teléfono <span class="text-red-500">*</span>
                        </label>
                        <div class="flex gap-2">
                            <input type="text" id="telefono-codigo" value="+569"
                                class="w-16 px-2 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80 text-center font-semibold"
                                placeholder="+569">
                            <input type="tel" id="telefono-numero" required
                                class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80"
                                placeholder="12345678"
                                maxlength="8"
                                pattern="[0-9]{8}">
                        </div>
                    </div>

                    <div>
                        <label for="fecha-ingreso" class="block text-xs font-medium text-gray-700 mb-1">
                            Fecha de Ingreso
                        </label>
                        <input type="date" id="fecha-ingreso"
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80">
                    </div>
                </div>

                <!-- Email, Ocupación y Dirección -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <div>
                        <label for="email" class="block text-xs font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="email"
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80"
                            placeholder="juan@ejemplo.com">
                    </div>

                    <div>
                        <label for="ocupacion" class="block text-xs font-medium text-gray-700 mb-1">Ocupación</label>
                        <input type="text" id="ocupacion"
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80"
                            placeholder="Ingeniero">
                    </div>

                    <div>
                        <label for="direccion" class="block text-xs font-medium text-gray-700 mb-1">
                            Dirección
                        </label>
                        <input type="text" id="direccion"
                            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80"
                            placeholder="Calle 123, Comuna">
                    </div>
                </div>

                <!-- Motivo de Consulta -->
                <div>
                    <label for="motivo-consulta" class="block text-xs font-medium text-gray-700 mb-1">
                        Motivo de Consulta <span class="text-red-500">*</span>
                    </label>
                    <textarea id="motivo-consulta" required rows="3"
                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm bg-white/80"
                        placeholder="Describa el motivo principal de la consulta..."></textarea>
                </div>
            </form>
        </div>

        <!-- PASO 2: Selección de Profesional -->
        <div id="step-2" class="card fade-in hidden">
            <h2 class="text-xl md:text-2xl font-bold text-gray-900 mb-3">Paso 2: Seleccione el Profesional</h2>

            <p class="text-gray-600 text-sm mb-4 text-center">¿Con qué profesional será la atención?</p>

            <form class="space-y-3">
                <!-- Selección de Profesional -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

                    <!-- Opción: Kinesiólogo -->
                    <label for="profesional-kinesiologo" class="cursor-pointer">
                        <input type="radio" id="profesional-kinesiologo" name="profesional" value="kinesiologo" class="hidden profesional-radio">
                        <div class="profesional-card border-3 border-gray-300 rounded-2xl p-8 text-center transition-all duration-300 hover:border-blue-500 hover:shadow-xl">
                            <div class="w-24 h-24 bg-gradient-to-br from-blue-500 to-blue-700 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                                <svg class="w-14 h-14 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-900 mb-3">Kinesiólogo</h3>
                            <p class="text-gray-600 text-sm mb-4">Tratamiento de lesiones, rehabilitación y recuperación física</p>
                            <div class="text-xs text-gray-500 space-y-1">
                                <p>• Evaluación funcional</p>
                                <p>• Ejercicios terapéuticos</p>
                                <p>• Manejo del dolor</p>
                            </div>
                        </div>
                    </label>

                    <!-- Opción: Acupunturista -->
                    <label for="profesional-acupunturista" class="cursor-pointer">
                        <input type="radio" id="profesional-acupunturista" name="profesional" value="acupunturista" class="hidden profesional-radio">
                        <div class="profesional-card border-3 border-gray-300 rounded-2xl p-8 text-center transition-all duration-300 hover:border-purple-500 hover:shadow-xl">
                            <div class="w-24 h-24 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                                <svg class="w-14 h-14 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-900 mb-3">Acupunturista</h3>
                            <p class="text-gray-600 text-sm mb-4">Medicina Tradicional China y terapias complementarias</p>
                            <div class="text-xs text-gray-500 space-y-1">
                                <p>• Diagnóstico MTC</p>
                                <p>• Acupuntura y moxibustión</p>
                                <p>• Balance energético</p>
                            </div>
                        </div>
                    </label>

                </div>

                <!-- Mensaje de selección requerida -->
                <div id="profesional-error" class="hidden text-red-600 text-center mt-4">
                    <p class="text-sm">Por favor, seleccione un profesional para continuar</p>
                </div>
            </form>

            <!-- Agregar estilos para las tarjetas seleccionadas -->
            <style>
                .profesional-radio:checked + .profesional-card {
                    border-width: 3px;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
                    transform: scale(1.02);
                }

                #profesional-kinesiologo:checked + .profesional-card {
                    border-color: #3b82f6;
                    background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(59, 130, 246, 0.1) 100%);
                }

                #profesional-acupunturista:checked + .profesional-card {
                    border-color: #a855f7;
                    background: linear-gradient(135deg, rgba(168, 85, 247, 0.05) 0%, rgba(168, 85, 247, 0.1) 100%);
                }
            </style>
        </div>

        <!-- PASO 3: Formularios Condicionales -->

        <!-- PASO 3 - KINESIÓLOGO -->
        <div id="step-3-kinesiologo" class="card fade-in hidden">
            <h2 class="text-3xl font-bold text-gray-900 mb-6">Paso 3: Evaluación Kinesiológica</h2>

            <form class="space-y-8">
                <!-- Evaluación Funcional -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-blue-900 mb-4">Evaluación Funcional</h3>

                    <!-- Movilidad Articular -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Movilidad Articular</label>
                        <textarea id="kine-movilidad" rows="3"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Describa limitaciones de movilidad, rangos articulares..."></textarea>
                    </div>

                    <!-- Fuerza Muscular -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Fuerza Muscular</label>
                        <textarea id="kine-fuerza" rows="3"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Evaluación de grupos musculares, debilidades detectadas..."></textarea>
                    </div>

                    <!-- Postura -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Análisis Postural</label>
                        <textarea id="kine-postura" rows="3"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Alteraciones posturales, desviaciones, compensaciones..."></textarea>
                    </div>
                </div>

                <!-- Evaluación del Dolor -->
                <div class="bg-red-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-red-900 mb-4">Evaluación del Dolor</h3>

                    <!-- Ubicación -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ubicación del Dolor/Lesión</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="cervical" class="text-red-600">
                                <span>Cervical</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="hombro" class="text-red-600">
                                <span>Hombro</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="codo" class="text-red-600">
                                <span>Codo</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="muneca" class="text-red-600">
                                <span>Muñeca/Mano</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="dorsal" class="text-red-600">
                                <span>Dorsal</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="lumbar" class="text-red-600">
                                <span>Lumbar</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="cadera" class="text-red-600">
                                <span>Cadera</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="rodilla" class="text-red-600">
                                <span>Rodilla</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-dolor-ubicacion" value="tobillo" class="text-red-600">
                                <span>Tobillo/Pie</span>
                            </label>
                        </div>
                    </div>

                    <!-- Intensidad del Dolor -->
                    <div class="mb-4">
                        <label for="kine-dolor-intensidad" class="block text-sm font-medium text-gray-700 mb-2">
                            Intensidad del Dolor (1-10)
                        </label>
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-gray-600">Leve</span>
                            <input type="range" id="kine-dolor-intensidad" min="1" max="10" value="5"
                                class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <span class="text-sm text-gray-600">Severo</span>
                            <span id="kine-dolor-intensidad-valor" class="text-2xl font-bold text-red-600 ml-4">5</span>
                        </div>
                    </div>

                    <!-- Características del Dolor -->
                    <div>
                        <label for="kine-dolor-caracteristicas" class="block text-sm font-medium text-gray-700 mb-2">
                            Características del Dolor
                        </label>
                        <textarea id="kine-dolor-caracteristicas" rows="2"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
                            placeholder="Tipo de dolor (punzante, sordo, quemante), frecuencia, factores que lo agravan o alivian..."></textarea>
                    </div>
                </div>

                <!-- Pruebas Especiales -->
                <div class="bg-green-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-green-900 mb-4">Pruebas Especiales y Tests</h3>
                    <textarea id="kine-tests" rows="4"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                        placeholder="Resultados de tests especiales, maniobras diagnósticas realizadas..."></textarea>
                </div>

                <!-- Diagnóstico Kinesiológico -->
                <div class="bg-purple-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-purple-900 mb-4">Diagnóstico Kinesiológico</h3>
                    <textarea id="kine-diagnostico" rows="4"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                        placeholder="Diagnóstico kinesiológico, hipótesis diagnóstica..."></textarea>
                </div>

                <!-- Plan de Tratamiento -->
                <div class="bg-yellow-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-yellow-900 mb-4">Plan de Tratamiento</h3>

                    <!-- Objetivos -->
                    <div class="mb-4">
                        <label for="kine-objetivos" class="block text-sm font-medium text-gray-700 mb-2">
                            Objetivos del Tratamiento
                        </label>
                        <textarea id="kine-objetivos" rows="3"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"
                            placeholder="Objetivos a corto y largo plazo..."></textarea>
                    </div>

                    <!-- Técnicas a Aplicar -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Técnicas y Modalidades</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-tecnicas" value="terapia_manual" class="text-yellow-600">
                                <span>Terapia Manual</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-tecnicas" value="ejercicios" class="text-yellow-600">
                                <span>Ejercicios Terapéuticos</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-tecnicas" value="electroterapia" class="text-yellow-600">
                                <span>Electroterapia</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-tecnicas" value="ultrasonido" class="text-yellow-600">
                                <span>Ultrasonido</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-tecnicas" value="calor_frio" class="text-yellow-600">
                                <span>Termoterapia/Crioterapia</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-tecnicas" value="vendaje" class="text-yellow-600">
                                <span>Vendaje Funcional/Kinesiotape</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-tecnicas" value="masoterapia" class="text-yellow-600">
                                <span>Masoterapia</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="kine-tecnicas" value="reeducacion" class="text-yellow-600">
                                <span>Reeducación Postural</span>
                            </label>
                        </div>
                    </div>

                    <!-- Frecuencia y Duración -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="kine-frecuencia" class="block text-sm font-medium text-gray-700 mb-2">
                                Frecuencia de Sesiones
                            </label>
                            <input type="text" id="kine-frecuencia"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"
                                placeholder="Ej: 2-3 veces por semana">
                        </div>
                        <div>
                            <label for="kine-duracion" class="block text-sm font-medium text-gray-700 mb-2">
                                Duración Estimada
                            </label>
                            <input type="text" id="kine-duracion"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"
                                placeholder="Ej: 4-6 semanas">
                        </div>
                    </div>

                    <!-- Ejercicios en Casa -->
                    <div>
                        <label for="kine-ejercicios-casa" class="block text-sm font-medium text-gray-700 mb-2">
                            Ejercicios en Casa / Recomendaciones
                        </label>
                        <textarea id="kine-ejercicios-casa" rows="3"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"
                            placeholder="Ejercicios y recomendaciones para realizar en casa..."></textarea>
                    </div>
                </div>

                <!-- Consentimiento Informado -->
                <div class="bg-green-50 p-6 rounded-lg border-2 border-green-200">
                    <label class="flex items-start space-x-3 cursor-pointer">
                        <input type="checkbox" id="kine-consentimiento" required class="mt-1 text-green-600">
                        <div>
                            <span class="font-semibold text-green-900">Consentimiento Informado <span class="text-red-500">*</span></span>
                            <p class="text-sm text-gray-700 mt-1">
                                El paciente ha sido informado sobre el tratamiento kinesiológico propuesto, sus posibles beneficios,
                                riesgos y alternativas. El paciente da su consentimiento para proceder con el tratamiento y entiende
                                que puede retirarlo en cualquier momento.
                            </p>
                        </div>
                    </label>
                </div>
            </form>
        </div>

        <!-- PASO 3 - ACUPUNTURISTA: MTC (Lengua y Pulso) -->
        <div id="step-3-acupunturista" class="hidden">
        <div class="card fade-in">
            <h2 class="text-3xl font-bold text-gray-900 mb-6">Paso 3: Evaluación y Diagnóstico MTC</h2>

            <form class="space-y-8">
                <!-- Sección Lengua -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-blue-900 mb-4">Lengua</h3>

                    <!-- Color de la Lengua -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Color</label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-color" value="palida" class="text-blue-600">
                                <span>Pálida</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-color" value="normal" class="text-blue-600">
                                <span>Normal (rosada)</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-color" value="roja" class="text-blue-600">
                                <span>Roja</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-color" value="purpura" class="text-blue-600">
                                <span>Púrpura</span>
                            </label>
                        </div>
                    </div>

                    <!-- Saburra -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Saburra</label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-saburra" value="fina-blanca" class="text-blue-600">
                                <span>Fina y blanca</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-saburra" value="gruesa" class="text-blue-600">
                                <span>Gruesa</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-saburra" value="amarilla" class="text-blue-600">
                                <span>Amarilla</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-saburra" value="sin-saburra" class="text-blue-600">
                                <span>Sin saburra</span>
                            </label>
                        </div>
                    </div>

                    <!-- Forma -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Forma</label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-forma" value="normal" class="text-blue-600">
                                <span>Normal</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-forma" value="hinchada" class="text-blue-600">
                                <span>Hinchada</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-forma" value="delgada" class="text-blue-600">
                                <span>Delgada</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="lengua-forma" value="rigida" class="text-blue-600">
                                <span>Rígida</span>
                            </label>
                        </div>
                    </div>

                    <!-- Observaciones de Lengua -->
                    <div>
                        <label for="lengua-observaciones" class="block text-sm font-medium text-gray-700 mb-2">
                            Observaciones adicionales
                        </label>
                        <textarea id="lengua-observaciones" rows="2"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Observaciones sobre la lengua..."></textarea>
                    </div>
                </div>

                <!-- Sección Pulso -->
                <div class="bg-green-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-green-900 mb-4">Pulso</h3>

                    <!-- Profundidad -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Profundidad</label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-profundidad" value="superficial" class="text-green-600">
                                <span>Superficial</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-profundidad" value="medio" class="text-green-600">
                                <span>Medio</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-profundidad" value="profundo" class="text-green-600">
                                <span>Profundo</span>
                            </label>
                        </div>
                    </div>

                    <!-- Velocidad -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Velocidad</label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-velocidad" value="lento" class="text-green-600">
                                <span>Lento (< 4 latidos/respiración)</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-velocidad" value="normal" class="text-green-600">
                                <span>Normal (4-5 latidos/respiración)</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-velocidad" value="rapido" class="text-green-600">
                                <span>Rápido (> 5 latidos/respiración)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Fuerza -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Fuerza</label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-fuerza" value="debil" class="text-green-600">
                                <span>Débil</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-fuerza" value="normal" class="text-green-600">
                                <span>Normal</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-fuerza" value="fuerte" class="text-green-600">
                                <span>Fuerte</span>
                            </label>
                        </div>
                    </div>

                    <!-- Calidad -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Calidad</label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-calidad" value="resbaladizo" class="text-green-600">
                                <span>Resbaladizo</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-calidad" value="rugoso" class="text-green-600">
                                <span>Rugoso</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-calidad" value="tenso" class="text-green-600">
                                <span>Tenso</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="pulso-calidad" value="filiforme" class="text-green-600">
                                <span>Filiforme</span>
                            </label>
                        </div>
                    </div>

                    <!-- Observaciones de Pulso -->
                    <div>
                        <label for="pulso-observaciones" class="block text-sm font-medium text-gray-700 mb-2">
                            Observaciones adicionales
                        </label>
                        <textarea id="pulso-observaciones" rows="2"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                            placeholder="Observaciones sobre el pulso..."></textarea>
                    </div>
                </div>

                <!-- Síntomas Generales -->
                <div class="bg-yellow-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-yellow-900 mb-4">Síntomas Principales</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="sintomas" value="dolor_cabeza" class="text-yellow-600">
                            <span>Dolor de cabeza</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="sintomas" value="mareos" class="text-yellow-600">
                            <span>Mareos</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="sintomas" value="insomnio" class="text-yellow-600">
                            <span>Insomnio</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="sintomas" value="fatiga" class="text-yellow-600">
                            <span>Fatiga</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="sintomas" value="sudoracion" class="text-yellow-600">
                            <span>Sudoración excesiva</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="sintomas" value="frio" class="text-yellow-600">
                            <span>Sensación de frío</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="sintomas" value="calor" class="text-yellow-600">
                            <span>Sensación de calor</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="sintomas" value="palpitaciones" class="text-yellow-600">
                            <span>Palpitaciones</span>
                        </label>
                    </div>
                </div>

                <!-- Emociones -->
                <div class="bg-purple-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-purple-900 mb-4">Estado Emocional</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="emociones" value="ansiedad" class="text-purple-600">
                            <span>Ansiedad</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="emociones" value="estres" class="text-purple-600">
                            <span>Estrés</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="emociones" value="tristeza" class="text-purple-600">
                            <span>Tristeza</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="emociones" value="irritabilidad" class="text-purple-600">
                            <span>Irritabilidad</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="emociones" value="preocupacion" class="text-purple-600">
                            <span>Preocupación excesiva</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="emociones" value="miedo" class="text-purple-600">
                            <span>Miedo</span>
                        </label>
                    </div>
                </div>

                <!-- Síntomas Digestivos -->
                <div class="bg-green-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-green-900 mb-4">Síntomas Digestivos</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="digestivos" value="nauseas" class="text-green-600">
                            <span>Náuseas</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="digestivos" value="vomitos" class="text-green-600">
                            <span>Vómitos</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="digestivos" value="diarrea" class="text-green-600">
                            <span>Diarrea</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="digestivos" value="estreñimiento" class="text-green-600">
                            <span>Estreñimiento</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="digestivos" value="hinchazon" class="text-green-600">
                            <span>Hinchazón abdominal</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="digestivos" value="gastritis" class="text-green-600">
                            <span>Gastritis</span>
                        </label>
                    </div>
                </div>

                <!-- Síntomas Menstruales -->
                <div class="bg-pink-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-pink-900 mb-4">Síntomas Menstruales (si aplica)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="menstruales" value="irregularidad" class="text-pink-600">
                            <span>Irregularidad menstrual</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="menstruales" value="dolor" class="text-pink-600">
                            <span>Dolor menstrual</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="menstruales" value="flujo_abundante" class="text-pink-600">
                            <span>Flujo abundante</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="menstruales" value="flujo_escaso" class="text-pink-600">
                            <span>Flujo escaso</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="menstruales" value="coagulos" class="text-pink-600">
                            <span>Coágulos</span>
                        </label>
                    </div>
                </div>

                <!-- Otros síntomas -->
                <div class="mb-6">
                    <label for="otros-sintomas" class="block text-sm font-medium text-gray-700 mb-2">
                        Otros síntomas no listados
                    </label>
                    <textarea id="otros-sintomas" rows="3"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Describa cualquier otro síntoma relevante..."></textarea>
                </div>

                <!-- Evaluación del Dolor -->
                <div class="bg-red-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-red-900 mb-4">Ubicación del Dolor</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-ubicacion" value="cervical" class="text-red-600">
                            <span>Cervical</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-ubicacion" value="dorsal" class="text-red-600">
                            <span>Dorsal</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-ubicacion" value="lumbar" class="text-red-600">
                            <span>Lumbar</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-ubicacion" value="hombro" class="text-red-600">
                            <span>Hombro</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-ubicacion" value="rodilla" class="text-red-600">
                            <span>Rodilla</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-ubicacion" value="cadera" class="text-red-600">
                            <span>Cadera</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-ubicacion" value="extremidades" class="text-red-600">
                            <span>Extremidades</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-ubicacion" value="abdomen" class="text-red-600">
                            <span>Abdomen</span>
                        </label>
                    </div>
                </div>

                <!-- Tipo de Dolor -->
                <div class="bg-orange-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold text-orange-900 mb-4">Tipo de Dolor</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-tipo" value="punzante" class="text-orange-600">
                            <span>Punzante</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-tipo" value="sordo" class="text-orange-600">
                            <span>Sordo</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-tipo" value="quemante" class="text-orange-600">
                            <span>Quemante</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-tipo" value="opresivo" class="text-orange-600">
                            <span>Opresivo</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-tipo" value="pulsatil" class="text-orange-600">
                            <span>Pulsátil</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="dolor-tipo" value="lacerante" class="text-orange-600">
                            <span>Lacerante</span>
                        </label>
                    </div>
                </div>

                <!-- Intensidad del Dolor -->
                <div class="mb-6">
                    <label for="dolor-intensidad" class="block text-sm font-medium text-gray-700 mb-2">
                        Intensidad del Dolor (1-10)
                    </label>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600">Leve</span>
                        <input type="range" id="dolor-intensidad" min="1" max="10" value="5"
                            class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <span class="text-sm text-gray-600">Severo</span>
                        <span id="dolor-intensidad-valor" class="text-2xl font-bold text-red-600 ml-4">5</span>
                    </div>
                </div>

                <!-- Frecuencia del Dolor -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Frecuencia del Dolor</label>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="dolor-frecuencia" value="constante" class="text-blue-600">
                            <span>Constante</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="dolor-frecuencia" value="intermitente" class="text-blue-600">
                            <span>Intermitente</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="dolor-frecuencia" value="ocasional" class="text-blue-600">
                            <span>Ocasional</span>
                        </label>
                    </div>
                </div>

                <!-- Factores de Alivio -->
                <div class="mb-6">
                    <label for="factores-alivio" class="block text-sm font-medium text-gray-700 mb-2">
                        ¿Qué alivia el dolor?
                    </label>
                    <textarea id="factores-alivio" rows="2"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Ej: reposo, calor, masajes..."></textarea>
                </div>

                <!-- Factores de Agravación -->
                <div class="mb-6">
                    <label for="factores-agravacion" class="block text-sm font-medium text-gray-700 mb-2">
                        ¿Qué agrava el dolor?
                    </label>
                    <textarea id="factores-agravacion" rows="2"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Ej: movimiento, frío, estrés..."></textarea>
                </div>

                <!-- Diagnóstico y Tratamiento MTC -->
                <div class="bg-gray-50 p-6 rounded-lg border-2 border-gray-200 mb-6">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        Resumen de la Ficha
                    </h3>
                    <div id="ficha-summary"></div>
                </div>

                <!-- Diagnóstico del Terapeuta -->
                <div class="mb-6">
                    <label for="diagnostico" class="block text-sm font-medium text-gray-700 mb-2">
                        Diagnóstico del Terapeuta (MTC)
                    </label>
                    <textarea id="diagnostico" rows="4"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Ej: Deficiencia de Qi de Bazo, Estancamiento de Qi de Hígado..."></textarea>
                </div>

                <!-- Plan de Tratamiento -->
                <div class="mb-6">
                    <label for="plan-tratamiento" class="block text-sm font-medium text-gray-700 mb-2">
                        Plan de Tratamiento
                    </label>
                    <textarea id="plan-tratamiento" rows="4"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Describa el plan de tratamiento propuesto..."></textarea>
                </div>

                <!-- Puntos de Acupuntura -->
                <div class="mb-6">
                    <label for="puntos-acupuntura" class="block text-sm font-medium text-gray-700 mb-2">
                        Puntos de Acupuntura
                    </label>
                    <input type="text" id="puntos-acupuntura"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Ej: E36, IG4, H3, B6... (separados por comas)">
                    <p class="mt-1 text-sm text-gray-500">Ingrese los puntos separados por comas</p>
                </div>

                <!-- Técnicas Aplicadas -->
                <div class="bg-blue-50 p-6 rounded-lg mb-6">
                    <h3 class="text-lg font-semibold text-blue-900 mb-3">Técnicas a Aplicar</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="tecnicas" value="acupuntura" class="text-blue-600">
                            <span>Acupuntura</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="tecnicas" value="moxibustion" class="text-blue-600">
                            <span>Moxibustión</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="tecnicas" value="ventosas" class="text-blue-600">
                            <span>Ventosas</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="tecnicas" value="electroacupuntura" class="text-blue-600">
                            <span>Electroacupuntura</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="tecnicas" value="tuina" class="text-blue-600">
                            <span>Tuina (masaje)</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" name="tecnicas" value="auriculoterapia" class="text-blue-600">
                            <span>Auriculoterapia</span>
                        </label>
                    </div>
                </div>

                <!-- Recomendaciones -->
                <div class="mb-6">
                    <label for="recomendaciones" class="block text-sm font-medium text-gray-700 mb-2">
                        Recomendaciones para el Paciente
                    </label>
                    <textarea id="recomendaciones" rows="4"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Recomendaciones dietéticas, ejercicios, hábitos, etc."></textarea>
                </div>

                <!-- Consentimiento Informado -->
                <div class="bg-green-50 p-6 rounded-lg border-2 border-green-200">
                    <label class="flex items-start space-x-3 cursor-pointer">
                        <input type="checkbox" id="consentimiento" required class="mt-1 text-green-600">
                        <div>
                            <span class="font-semibold text-green-900">Consentimiento Informado <span class="text-red-500">*</span></span>
                            <p class="text-sm text-gray-700 mt-1">
                                El paciente ha sido informado sobre el tratamiento propuesto, sus posibles beneficios y riesgos,
                                y ha dado su consentimiento para proceder. El paciente entiende que puede retirar su consentimiento
                                en cualquier momento.
                            </p>
                        </div>
                    </label>
                </div>
            </form>
        </div>
        </div>

        <!-- OLD STEPS REMOVED - Content integrated above into step-3-acupunturista -->

        <!-- Botones de Navegación -->
        <div class="flex justify-between items-center mt-8">
            <button id="prev-btn" class="hidden bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition font-semibold">
                ← Anterior
            </button>

            <div class="flex-1"></div>

            <button id="next-btn" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold">
                Siguiente →
            </button>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-3 mt-6">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm">&copy; 2025 Centro Vida Sana Austral</p>
            <p class="text-xs mt-0.5 text-gray-400">Kinesiología • Acupuntura</p>
        </div>
    </footer>

    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- App Scripts -->
    <script type="module">
        import { initSupabase, requireAuth, signOut } from './js/auth.js';
        import { initFormManager } from './js/formManager.js';
        import { storage } from './js/utils.js';

        // Inicializar aplicación
        async function init() {
            // Inicializar Supabase
            await initSupabase();

            // Requiere autenticación
            const authenticated = await requireAuth();
            if (!authenticated) return;

            // Inicializar gestor de formulario
            initFormManager();

            // Setup event listeners adicionales
            setupEventListeners();
        }

        function setupEventListeners() {
            // Botón de logout
            document.getElementById('logout-btn')?.addEventListener('click', async () => {
                if (confirm('¿Estás seguro de que deseas cerrar sesión?')) {
                    await signOut();
                }
            });

            // Botón de guardar borrador manual
            document.getElementById('save-draft-btn')?.addEventListener('click', () => {
                // La función de guardado está en formManager.js
                storage.saveDraft(window.formState?.formData || {});
            });

            // Actualizar valor de intensidad de dolor (Acupuntura)
            const dolorIntensidad = document.getElementById('dolor-intensidad');
            const dolorIntensidadValor = document.getElementById('dolor-intensidad-valor');

            if (dolorIntensidad && dolorIntensidadValor) {
                dolorIntensidad.addEventListener('input', (e) => {
                    dolorIntensidadValor.textContent = e.target.value;
                });
            }

            // Actualizar valor de intensidad de dolor (Kinesiología)
            const kineDolorIntensidad = document.getElementById('kine-dolor-intensidad');
            const kineDolorIntensidadValor = document.getElementById('kine-dolor-intensidad-valor');

            if (kineDolorIntensidad && kineDolorIntensidadValor) {
                kineDolorIntensidad.addEventListener('input', (e) => {
                    kineDolorIntensidadValor.textContent = e.target.value;
                });
            }

            // ====================================
            // NUEVAS FUNCIONALIDADES
            // ====================================

            // Setear fecha de ingreso automáticamente a hoy
            const fechaIngresoInput = document.getElementById('fecha-ingreso');
            if (fechaIngresoInput && !fechaIngresoInput.value) {
                const today = new Date().toISOString().split('T')[0];
                fechaIngresoInput.value = today;
            }

            // Calcular edad automáticamente desde fecha de nacimiento
            const fechaNacimientoInput = document.getElementById('fecha-nacimiento');
            const edadInput = document.getElementById('edad');

            if (fechaNacimientoInput && edadInput) {
                fechaNacimientoInput.addEventListener('change', (e) => {
                    const birthDate = new Date(e.target.value);
                    const today = new Date();

                    if (!isNaN(birthDate.getTime())) {
                        let age = today.getFullYear() - birthDate.getFullYear();
                        const monthDiff = today.getMonth() - birthDate.getMonth();

                        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                            age--;
                        }

                        edadInput.value = age >= 0 ? age : '';
                    } else {
                        edadInput.value = '';
                    }
                });
            }

            // Formatear RUT automáticamente (formato: 12.345.678-9)
            const rutInput = document.getElementById('rut');
            if (rutInput) {
                rutInput.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/[^0-9kK]/g, '');

                    if (value.length > 0) {
                        // Separar dígito verificador
                        const dv = value.slice(-1);
                        let number = value.slice(0, -1);

                        // Formatear número con puntos
                        number = number.replace(/\B(?=(\d{3})+(?!\d))/g, '.');

                        // Juntar con guión y dígito verificador
                        if (value.length > 1) {
                            e.target.value = number + '-' + dv;
                        } else {
                            e.target.value = value;
                        }
                    }
                });

                // Validar RUT al salir del campo
                rutInput.addEventListener('blur', (e) => {
                    const rut = e.target.value;
                    if (rut && !validarRUT(rut)) {
                        e.target.classList.add('border-red-500');
                        // Crear mensaje de error si no existe
                        if (!document.getElementById('rut-error')) {
                            const errorMsg = document.createElement('p');
                            errorMsg.id = 'rut-error';
                            errorMsg.className = 'text-red-500 text-sm mt-1';
                            errorMsg.textContent = 'RUT inválido';
                            e.target.parentElement.appendChild(errorMsg);
                        }
                    } else {
                        e.target.classList.remove('border-red-500');
                        document.getElementById('rut-error')?.remove();
                    }
                });
            }

            // Validar formato de teléfono (solo números)
            const telefonoNumeroInput = document.getElementById('telefono-numero');
            if (telefonoNumeroInput) {
                telefonoNumeroInput.addEventListener('input', (e) => {
                    e.target.value = e.target.value.replace(/[^0-9]/g, '');
                });
            }
        }

        // Función para validar RUT chileno
        function validarRUT(rut) {
            // Limpiar formato
            rut = rut.replace(/\./g, '').replace(/-/g, '');

            if (rut.length < 2) return false;

            const dv = rut.slice(-1).toUpperCase();
            const numero = rut.slice(0, -1);

            if (!/^\d+$/.test(numero)) return false;

            // Calcular dígito verificador
            let suma = 0;
            let multiplo = 2;

            for (let i = numero.length - 1; i >= 0; i--) {
                suma += parseInt(numero[i]) * multiplo;
                multiplo = multiplo === 7 ? 2 : multiplo + 1;
            }

            const dvEsperado = 11 - (suma % 11);
            const dvCalculado = dvEsperado === 11 ? '0' : dvEsperado === 10 ? 'K' : dvEsperado.toString();

            return dv === dvCalculado;
        }

        // Inicializar cuando el DOM esté listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
